From fingerle at mail.berlios.de  Sun Nov 19 18:57:46 2006
From: fingerle at mail.berlios.de (fingerle at BerliOS)
Date: Sun, 19 Nov 2006 18:57:46 +0100
Subject: [fellowiki-svncheckins] r32 - pjm trunk trunk/fellowiki
	trunk/fellowiki/config trunk/fellowiki/controllers
	trunk/fellowiki/controllers/wikiparser trunk/fellowiki/model
	trunk/fellowiki/templates trunk/fellowiki/util
	trunk/fellowiki/widgets
Message-ID: <200611191757.kAJHvkPB023294@sheep.berlios.de>

Author: fingerle
Date: 2006-11-19 18:57:44 +0100 (Sun, 19 Nov 2006)
New Revision: 32

Added:
   trunk/fellowiki-www.py
   trunk/fellowiki/controllers/wiki.py
   trunk/fellowiki/templates/wiki_edit.kid
   trunk/fellowiki/templates/wiki_view.kid
   trunk/fellowiki/util/xmlelement.py
   trunk/fellowiki/widgets/
   trunk/fellowiki/widgets/__init__.py
   trunk/fellowiki/widgets/forms.py
Removed:
   pjm/tools/
   trunk/fellowiki.py
   trunk/fellowiki/templates/default.kid
   trunk/fellowiki/templates/welcome.kid
Modified:
   pjm/milestones.txt
   pjm/tasks.txt
   trunk/README.txt
   trunk/fellowiki/config/app.cfg
   trunk/fellowiki/controllers/__init__.py
   trunk/fellowiki/controllers/wikiparser/parser.py
   trunk/fellowiki/model/__init__.py
   trunk/fellowiki/model/model_classes.py
   trunk/fellowiki/model/schema.py
   trunk/fellowiki/templates/login.kid
   trunk/fellowiki/templates/master.kid
   trunk/fellowiki/util/assorted.py
   trunk/setup.py
Log:
Many changes to Turbogearsify Fellowiki


Modified: pjm/milestones.txt
===================================================================
--- pjm/milestones.txt	2006-09-10 23:39:54 UTC (rev 31)
+++ pjm/milestones.txt	2006-11-19 17:57:44 UTC (rev 32)
@@ -5,7 +5,6 @@
 planned:
 ========
 
-0.0.1 working wiki parser
 0.1.0 working wiki 
 0.2.0 page templates are wiki pages
 0.3.0 user DB & access restriction

Modified: pjm/tasks.txt
===================================================================
--- pjm/tasks.txt	2006-09-10 23:39:54 UTC (rev 31)
+++ pjm/tasks.txt	2006-11-19 17:57:44 UTC (rev 32)
@@ -1,3 +1,2 @@
 *) simple web site
 *) some kind of issue tracker - but I don't like the BerliOS ones
-*) get svn mailing list working

Modified: trunk/README.txt
===================================================================
--- trunk/README.txt	2006-09-10 23:39:54 UTC (rev 31)
+++ trunk/README.txt	2006-11-19 17:57:44 UTC (rev 32)
@@ -1,4 +1,4 @@
 FelloWiki
 
 This is a TurboGears (http://www.turbogears.org) project. It can be
-started by running the start-fellowiki.py script.
\ No newline at end of file
+started by running the fellowiki.py script.

Modified: trunk/fellowiki/config/app.cfg
===================================================================
--- trunk/fellowiki/config/app.cfg	2006-09-10 23:39:54 UTC (rev 31)
+++ trunk/fellowiki/config/app.cfg	2006-11-19 17:57:44 UTC (rev 32)
@@ -57,6 +57,87 @@
 # Set to True if the scheduler should be started
 # tg.scheduler = False
 
+# VISIT TRACKING
+# Each visit to your application will be assigned a unique visit ID tracked via
+# a cookie sent to the visitor's browser.
+# --------------
+
+# Enable Visit tracking
+visit.on=True
+
+# Number of minutes a visit may be idle before it expires.
+visit.timeout=60
+
+# The name of the cookie to transmit to the visitor's browser.
+visit.cookie.name="fw-visit"
+
+# Domain name to specify when setting the cookie (must begin with . according to
+# RFC 2109). The default (None) should work for most cases and will default to
+# the machine to which the request was made. NOTE: localhost is NEVER a valid
+# value and will NOT WORK.
+# visit.cookie.domain=None
+
+# Specific path for the cookie
+# visit.cookie.path="/"
+
+# The name of the VisitManager plugin to use for visitor tracking.
+visit.manager="sqlalchemy"
+
+# Database class to use for visit tracking
+visit.saprovider.model = "fellowiki.model.Visit"
+
+# IDENTITY
+# General configuration of the TurboGears Identity management module
+# --------
+
+# Switch to turn on or off the Identity management module
+identity.on=True
+
+# [REQUIRED] URL to which CherryPy will internally redirect when an access
+# control check fails. If Identity management is turned on, a value for this
+# option must be specified.
+identity.failure_url="/login"
+
+identity.provider='sqlalchemy'
+
+# The names of the fields on the login form containing the visitor's user ID
+# and password. In addition, the submit button is specified simply so its
+# existence may be stripped out prior to passing the form data to the target
+# controller.
+# identity.form.user_name="user_name"
+# identity.form.password="password"
+# identity.form.submit="login"
+
+# What sources should the identity provider consider when determining the
+# identity associated with a request? Comma separated list of identity sources.
+# Valid sources: form, visit, http_auth
+# identity.source="form,http_auth,visit"
+
+# SqlAlchemyIdentityProvider
+# Configuration options for the default IdentityProvider
+# -------------------------
+
+# The classes you wish to use for your Identity model. Remember to not use reserved
+# SQL keywords for class names (at least unless you specify a different table
+# name using sqlmeta).
+identity.saprovider.model.user="fellowiki.model.User"
+identity.saprovider.model.group="fellowiki.model.Group"
+identity.saprovider.model.permission="fellowiki.model.Permission"
+identity.saprovider.model.visit="fellowiki.model.VisitIdentity"
+
+# The password encryption algorithm used when comparing passwords against what's
+# stored in the database. Valid values are 'md5' or 'sha1'. If you do not
+# specify an encryption algorithm, passwords are expected to be clear text.
+#
+# The SqlAlchemyProvider *will* encrypt passwords supplied as part of your login
+# form.  If you set the password through the password property, like:
+# my_user.password = 'secret'
+# the password will be encrypted in the database, provided identity is up and 
+# running, or you have loaded the configuration specifying what encryption to
+# use (in situations where identity may not yet be running, like tests).
+
+#identity.saprovider.encryption_algorithm="sha1"
+
 [/static]
 static_filter.on = True
 static_filter.dir = "%(top_level_dir)s/static"

Modified: trunk/fellowiki/controllers/__init__.py
===================================================================
--- trunk/fellowiki/controllers/__init__.py	2006-09-10 23:39:54 UTC (rev 31)
+++ trunk/fellowiki/controllers/__init__.py	2006-11-19 17:57:44 UTC (rev 32)
@@ -1,5 +1,9 @@
 # Copyright (c) 2006 Jan Niklas Fingerle
 # 
+# This source code file is based on a TurboGears "quickstarted" project.
+# The TurboGears framework is copyrighted (c) 2005, 2006 by Kevin Dangoor 
+# and contributors.
+#
 # Permission is hereby granted, free of charge, to any person obtaining a
 # copy of this software and associated documentation files (the "Software"),
 # to deal in the Software without restriction, including without limitation
@@ -19,58 +23,51 @@
 # DEALINGS IN THE SOFTWARE.
 
 import logging
-
 import cherrypy
+from turbogears import expose, identity
 
-import turbogears
-from turbogears import controllers, expose, validate, redirect
-from turbogears.database import session
+from turbogears.controllers import RootController, redirect
 from fellowiki.model import *
+import wiki
 
-from fellowiki import json
-
 log = logging.getLogger("fellowiki.controllers")
 
-class FelloWikiRoot(controllers.RootController):
-    @expose(template="fellowiki.templates.welcome")
+                    
+class FelloWikiRoot(RootController):
+    redirect_default = 'admin'
+    def __init__(self):
+        wiki.register_wikis(self)
+    
+    @expose()
     def index(self):
-        cherrypy.log('Versions:', 'DEBUG', 0)
-        versions = DBVersion.select()
-        for item in versions:
-            cherrypy.log(unicode(item), 'DEBUG', 0)
-        import time
-        log.debug("Happy TurboGears Controller Responding For Duty")
-        return dict(now=time.ctime())
+        redirect(self.redirect_default)
 
-##
-##import cherrypy
-##from view import expose
-##import sqlalchemy
-##
-##from fellowiki.database.schema import metadata
-##
-##from fellowiki.database.model import *
-##
-##class FelloWikiRoot:
-##    @expose()
-##    def index(self):
-##        
-##        versions = DBVersion.select()
-##        
-##        return dict(page_title = 'Welcome to FelloWiki!',
-##                    page_body = 'index body: ' )
-##    
-##class WikiInstance:
-##    @expose()
-##    def default(self, *args, **kwargs):
-##        return dict(page_title = 'Welcome to FelloWiki!',
-##                    page_body = 'wiki instance: '+unicode(args))
-##           
-##class DataBaseHelper:
-##    def __init__(self, error_string):
-##        self.error_string = error_string
-##        
-##    @expose()
-##    def default(self, *args, **kwargs):
-##        return dict(page_title = 'FelloWiki: data base not available',
-##                    page_body = self.error_string)
+    @expose(template="fellowiki.templates.login")
+    def login(self, forward_url=None, previous_url=None, *args, **kw):
+
+        if not identity.current.anonymous \
+            and identity.was_login_attempted() \
+            and not identity.get_identity_errors():
+            raise redirect(forward_url)
+
+        forward_url=None
+        previous_url= cherrypy.request.path
+
+        if identity.was_login_attempted():
+            msg=_("The credentials you supplied were not correct or "
+                   "did not grant access to this resource.")
+        elif identity.get_identity_errors():
+            msg=_("You must provide your credentials before accessing "
+                   "this resource.")
+        else:
+            msg=_("Please log in.")
+            forward_url= cherrypy.request.headers.get("Referer", "/")
+        cherrypy.response.status=403
+        return dict(message=msg, previous_url=previous_url, logging_in=True,
+                    original_parameters=cherrypy.request.params,
+                    forward_url=forward_url)
+
+    @expose()
+    def logout(self):
+        identity.current.logout()
+        raise redirect("/")

Added: trunk/fellowiki/controllers/wiki.py
===================================================================
--- trunk/fellowiki/controllers/wiki.py	2006-09-10 23:39:54 UTC (rev 31)
+++ trunk/fellowiki/controllers/wiki.py	2006-11-19 17:57:44 UTC (rev 32)
@@ -0,0 +1,277 @@
+# Copyright (c) 2006 Jan Niklas Fingerle
+# 
+# Permission is hereby granted, free of charge, to any person obtaining a
+# copy of this software and associated documentation files (the "Software"),
+# to deal in the Software without restriction, including without limitation
+# the rights to use, copy, modify, merge, publish, distribute, sublicense,
+# and/or sell copies of the Software, and to permit persons to whom the
+# Software is furnished to do so, subject to the following conditions:
+#
+# The above copyright notice and this permission notice shall be included in
+# all copies or substantial portions of the Software.
+#
+# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
+# THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
+# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
+# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
+# DEALINGS IN THE SOFTWARE.
+
+import cherrypy
+from turbogears import expose, controllers, validate, error_handler, identity
+
+from turbogears.controllers import Controller, redirect
+import turbogears
+import turbogears.widgets as w
+import turbogears.validators as v
+import copy
+
+from fellowiki.util.xmlelement import XMLElement, SubElement
+
+from fellowiki.util.assorted import check_for_permission
+from fellowiki.model import *
+
+from fellowiki.widgets.forms import SubmitPreviewTableForm
+
+from wikiparser.parser import WikiParser
+
+from sqlalchemy import desc,asc, and_, or_
+from sqlalchemy.exceptions import InvalidRequestError
+
+
+from wikiparser import macros, tables, lists, headlines, special_characters, \
+            escaped_text, links, special_markup, text_style, \
+            text_style_simple, structure_modifiers
+
+extensions = [macros, tables, lists, headlines, special_characters,
+              escaped_text, links, special_markup, text_style,
+              text_style_simple, structure_modifiers]
+
+from fellowiki.model import *
+
+__all__ = ['register_wikis']
+
+        
+def no_cache(f):
+    def new_f(*args, **kwargs):
+        cherrypy.response.headers['Pragma'] = 'no-cache'
+        if cherrypy.response.version <> '1.0':
+            cherrypy.response.headers['Cache-Control'] = 'no-cache'
+        return f(*args, **kwargs)
+    return new_f
+        
+def extract_ressource_key(num_args):
+    def erp(f):
+        def new_f(self, *args, **kw_args):
+            return f(self, ressource_key=self.get_ressource_key(args[num_args:]),
+                     *(args[0:num_args]), **kw_args)
+        return new_f
+    return erp
+        
+        
+# Edit form
+        
+text_types = [(t.mime_type, t.name) 
+                for t in WikiItemType.select(order_by=[desc(WikiItemType.c.wiki_text),
+                                                            WikiItemType.c.name])
+                if t.text]
+
+binary_types = [(t.mime_type, t.name) 
+                for t in WikiItemType.select(order_by=WikiItemType.c.name)
+                if not t.text]
+
+try:
+    default_text_type = text_types[0][0]
+except IndexError:
+    default_text_type = None
+        
+try:
+    default_binary_type = binary_types[0][0]
+except IndexError:
+    default_binary_type = None
+        
+wiki_edit_form = SubmitPreviewTableForm(
+            fields=[w.TextArea(name='wiki_text', label='My Wiki Text', validator=v.NotEmpty),
+                    w.TextField(name='comment', label='My Comment', validator=v.NotEmpty),
+                    w.CheckBox(name='minor_change', label="This is a minor change."),
+                    w.SingleSelectField(name="data type", label='My Data Type',  
+                          options=text_types,   
+                                    default=default_text_type
+                          ),
+                    w.HiddenField(name='version', validator=v.All(v.Int, v.NotEmpty))],
+                    # validator = v.Schema(chained_validators=[v.FieldsMatch("comment",  "comment2")]),
+                    submit_text="Save", preview_text="Preview", reset_text="Reset")
+        
+del text_types, binary_types, default_text_type, default_binary_type
+        
+        
+class WikiInstance(Controller, identity.SecureResource):
+    def __init__(self, wiki):
+        self.name = wiki.name
+        self.wiki_id = wiki.wiki_id
+        self.parser = WikiParser([], extensions)
+        self.registry = {}
+        
+        for entry in wiki.registry_items:
+            try:
+                column_name = Registry.TYPES[type]
+                self.registry[entry.key] = getattr(entry, column_name)
+            except KeyError:
+                pass
+        
+        self.home_page = self.registry.get('home page', 'Home')
+
+        if wiki.read_permission is not None:
+            self.rd_perm = wiki.read_permission.permission_name
+        else:
+            self.rd_perm = None
+            
+        if wiki.write_permission is not None:
+            self.wr_perm = wiki.write_permission.permission_name
+        else:
+            self.wr_perm = self.rd_perm
+            
+        if wiki.admin_permission is not None:
+            self.adm_perm = wiki.admin_permission.permission_name
+        else:
+            self.adm_perm = self.wr_perm
+            
+        if wiki.protect_read_history:
+            self.rd_hist_perm = self.wr_perm
+        else:
+            self.rd_hist_perm = self.rd_perm 
+        
+    def get_ressource_key(self, ressource_path = []):
+        ressource_path = filter(None, ressource_path)
+        if len(ressource_path) == 0:
+            return self.home_page
+        return '/'.join(ressource_path)
+    
+    @expose()
+    @no_cache
+    def index(self):
+        check_for_permission(self.rd_perm)
+        redirect("view/%s" % self.get_ressource_key())
+        
+        
+        
+    @expose(template="fellowiki.templates.wiki_view")
+    @no_cache
+    @extract_ressource_key(0)
+    @validate(validators={"version": v.Int})
+    def view(self, ressource_key, version=None, tg_errors={}):
+        if version is None:
+            check_for_permission(self.rd_perm)
+        else:
+            check_for_permission(self.rd_hist_perm)
+        edit_link = '/'.join([cherrypy.request.object_path[:-5], 'edit', ressource_key])
+        try:
+            if version is None:
+                current_version = WikiItem.selectone(and_(WikiItem.c.name==ressource_key,
+                                                          WikiItem.c.wiki_id==self.wiki_id),
+                                        order_by=desc(WikiItem.c.version),
+                                        limit=1)    
+            else:
+                current_version = WikiItem.selectone(and_(WikiItem.c.name==ressource_key,
+                                                          WikiItem.c.version==version,
+                                                          WikiItem.c.wiki_id==self.wiki_id))
+        except InvalidRequestError:
+            if version is None:
+                redirect(edit_link)
+            else:
+                raise cherrypy.NotFound
+      
+        parsed_content = self.parser.parse(current_version.text_content)
+        content = self.parser.evaluate(parsed_content)
+        
+        page_is_editable = version is None
+        
+        
+        
+        return dict(title='FelloWiki - %s' % ressource_key, 
+                    page_name=ressource_key, 
+                    main_content=content,
+                    edit_link=edit_link,
+                    page_is_editable=page_is_editable)
+            
+            
+    @expose()
+    @extract_ressource_key(0)
+    @validate(validators={"version": v.Int(not_empty=True)})
+    def source(self, ressource_key, version=None, tg_errors={}):
+        if version is None:
+            check_for_permission(self.rd_perm)
+        else:
+            check_for_permission(self.rd_hist_perm)
+        if len(tg_errors) > 0:
+            raise cherrypy.NotFound
+            
+        try:
+            selected_version = WikiItem.selectone(and_(WikiItem.c.name==ressource_key,
+                                                       WikiItem.c.version==version,
+                                                       WikiItem.c.wiki_id==self.wiki_id))
+        except InvalidRequestError:
+            raise cherrypy.NotFound
+      
+        item_type = selected_version.item_type
+        cherrypy.response.headers['Content-Type'] = item_type.mime_type
+        # TODO: set Header for encoding?
+        
+        if item_type.text:
+            return selected_version.text_content
+        else:
+            return selected_version.binary_content
+    
+    # a bit hackish, but I want to have *all* of the decorators functionality
+    # without decorating...
+    @validate(form=wiki_edit_form)
+    def validate_edit_form(self, tg_errors={}, **input_data):
+        return tg_errors, input_data
+
+    @expose(template="fellowiki.templates.wiki_edit") 
+    @no_cache
+    @extract_ressource_key(0)
+    def edit(self, ressource_key, **input_data):
+        check_for_permission(self.wr_perm)
+        form_data = dict()
+        preview = None
+        
+        try:
+            prev_version = WikiItem.selectone(and_(WikiItem.c.name==ressource_key,
+                                                   WikiItem.c.wiki_id==self.wiki_id),
+                                       order_by=desc(WikiItem.c.version),
+                                       limit=1)
+        except InvalidRequestError:
+            prev_version = None
+      
+         
+        if len(input_data) == 0:
+            if prev_version is None:
+                form_data['version'] = 0
+            else:
+                form_data['wiki_text'] = prev_version.text_content
+                form_data['version'] = prev_version.version
+                
+        else:
+            parsed_content = self.parser.parse(input_data['wiki_text'])
+            preview = self.parser.evaluate(parsed_content)
+            
+            tg_errors, input_data = self.validate_edit_form(**input_data)
+            
+            if len(tg_errors) == 0:
+                
+                item = WikiItem(ressource_key, input_data['version']+1, self.wiki_id,
+                                'wiki text', text_content=input_data['wiki_text'], 
+                                cache=parsed_content)
+                redirect('/'.join([cherrypy.request.object_path[:-5], 'view', ressource_key]))
+                
+                
+        
+        return dict(form=wiki_edit_form, data=form_data, preview = preview)
+
+
+def register_wikis(parent):
+    for wiki in Wiki.select():
+        if not hasattr(parent, wiki.name):
+            setattr(parent, wiki.name, WikiInstance(wiki))

Modified: trunk/fellowiki/controllers/wikiparser/parser.py
===================================================================
--- trunk/fellowiki/controllers/wikiparser/parser.py	2006-09-10 23:39:54 UTC (rev 31)
+++ trunk/fellowiki/controllers/wikiparser/parser.py	2006-11-19 17:57:44 UTC (rev 32)
@@ -27,13 +27,14 @@
     
 """
 
-import elementtree.ElementTree as ElementTree
 from fellowiki.util.assorted import attributes_from_dict
+import elementtree.ElementTree as ElementTree
+from fellowiki.util.xmlelement import XMLElement
 from util import remove_backslashes_and_whitespace, remove_escaping_backslashes
       
 import sre
 import re
-from copy import copy, deepcopy
+from copy import deepcopy
 
 
 PREFIX_COUNT = "prefix count"
@@ -49,78 +50,7 @@
 END_TOKEN = 'end token'
 ENCAPSULATE_TOKEN = 'encapsulate token'
 PREFIX = 'prefix'
-        
 
-            
-class XMLElement(object):
-    def __init__(self, tag = None):
-        self.tag = tag
-        self.content = []
-        self.attributes = {}
-        self.callback = []
-        self.translations = []
-        
-    def clone(self, other):
-        self.tag = other.tag
-        self.content = other.content
-        self.attributes = other.attributes
-        self.callback = other.callback
-        self.translations = other.translations
-        
-    def to_element_tree(self): 
-        xhtml = ElementTree.Element(self.tag)
-        sub_xhtml = None
-        xhtml.attrib = copy(self.attributes)
-        current_textlist = []
-        content = copy(self.content)
-        translations = []
-        
-        # I want to modify the list, therefore I write this a bit 
-        # more explicitly:
-        while content:
-            item = content.pop(0) 
-            try: # should work, if it's a text list
-                current_textlist.extend(item)
-            except TypeError: # should be an XMLElement
-                if item.tag is None:
-                    content = item.content + content
-                else:
-                    current_text = ''.join(current_textlist)
-                    current_textlist = []
-                    if sub_xhtml is None:
-                        xhtml.text = current_text
-                    else:
-                        sub_xhtml.tail = current_text
-                    sub_xhtml, sub_translations = item.to_element_tree()
-                    xhtml.append(sub_xhtml)
-                    translations.extend(sub_translations)
-        current_text = ''.join(current_textlist)
-        if sub_xhtml is None:
-            xhtml.text = current_text
-        else:
-            sub_xhtml.tail = current_text
-        for translation in self.translations:
-            if translation[1] is None:
-                translations.append((xhtml, 
-                                     translation[0], 
-                                     translation[2]))
-            else:
-                translation[1](xhtml, translation[2])
-        return xhtml, translations
-        
-    def is_empty(self):
-        return not bool(self.content)
-        
-    def is_not_empty(self):
-        return bool(self.content)
-            
-    def append(self, *appendee):
-        self.content.extend(appendee)
-    
-    def prepend(self, *prependee):
-        self.content = list(prependee) + self.content
-        
-
 class WikiError(StandardError):
     pass
 
@@ -435,6 +365,8 @@
 
     def parse(self, text):
         import time
+        
+        text = re.sub('\r\n', '\n', text)
         tokens = self.scanner.scan(''.join(['\n\n', text, '\n\n']))
         
         if tokens[1] != '':

Modified: trunk/fellowiki/model/__init__.py
===================================================================
--- trunk/fellowiki/model/__init__.py	2006-09-10 23:39:54 UTC (rev 31)
+++ trunk/fellowiki/model/__init__.py	2006-11-19 17:57:44 UTC (rev 32)
@@ -8,7 +8,7 @@
 # Software is furnished to do so, subject to the following conditions:
 #
 # The above copyright notice and this permission notice shall be included in
-# all copies or substantial portions of the Software.
+# all copies or substantial porhtions of the Software.
 #
 # THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 # IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,

Modified: trunk/fellowiki/model/model_classes.py
===================================================================
--- trunk/fellowiki/model/model_classes.py	2006-09-10 23:39:54 UTC (rev 31)
+++ trunk/fellowiki/model/model_classes.py	2006-11-19 17:57:44 UTC (rev 32)
@@ -18,87 +18,181 @@
 # FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
 # DEALINGS IN THE SOFTWARE.
 
+# TODO: add reference to quickstarted project
+
+
 from sqlalchemy import *
 from sqlalchemy.ext.assignmapper import assign_mapper
-from sqlalchemy.ext.sessioncontext import SessionContext
 
 import turbogears.database
 
+from fellowiki.util.assorted import attributes_from_dict
 from schema import *
 
-__all__ = ['DBVersion', 'User', 'Login', 'Group', 'Task', 'RessourceType', 
-           'Ressource', 'LoginTask', 'WikiItemType', 'WikiItem']
+__all__ = ['DBVersion', 'Visit', 'VisitIdentity', 'Group', 'User',
+           'Permission', 'Wiki', 'WikiItemType', 'WikiItem', 'Registry', 
+           'initialize']
 
 sc = turbogears.database.session.context
 
-## more cascades?
-
 class DBVersion(object):
     def __init__(self, prj, db_version):
         self.prj = prj
         self.db_version = db_version
     def __repr__(self):
         return u"DBVersion(%s, %s)" %(repr(self.prj), repr(self.db_version))
+        
+assign_mapper(sc, DBVersion, db_version)
 
-class User(object): pass
 
-class Login(object): pass
+# visit and identity
 
-class Group(object): pass
+class Visit(object):
+    @classmethod
+    def lookup_visit(cls, visit_key):
+        return Visit.get(visit_key)
+        
+assign_mapper(sc, Visit, visit)
 
-class Task(object): pass
 
-class RessourceType(object): pass
+class VisitIdentity(object): pass
+        
+assign_mapper(sc, VisitIdentity, visit_identity)
 
-class Ressource(object): pass
 
-class LoginTask(object): pass
+class Group(object):
+    def __init__(self, group_name, display_name, permissions):
+        self.group_name = group_name
+        self.display_name = display_name
+        self.permissions.extend(permissions)
     
-class WikiItemType(object): pass
+assign_mapper(sc, Group, group)
 
-class WikiItem(object): pass
+class User(object):
+    def __init__(self, user_name, display_name, password, groups):
+        self.user_name = user_name
+        self.display_name = display_name
+        self.password = password
+        self.groups.extend(groups)
+        
+    def permissions(self):
+        perms = set()
+        for g in self.groups:
+            perms = perms | set(g.permissions)
+        return perms
+    permissions = property(permissions)
+        
+assign_mapper(sc, User, user,
+              properties = {'groups': relation(Group, secondary=user_group, backref='users')})
+                  
+                  
+class Permission(object):
+    def __init__(self, permission_name, description):
+        attributes_from_dict(locals())
+        
+assign_mapper(sc, Permission, permission,
+              properties = {'groups': relation(Group, secondary=group_permission, backref='permissions')})
+
+
+# Wiki
+
+class Wiki(object):
+    def __init__(self, name, read_permission=None, 
+                 write_permission=None, admin_permission=None,
+                 protect_read_history=False):
+        attributes_from_dict(locals())
+
+assign_mapper(sc, Wiki, wiki,
+              properties = {'read_permission': relation(Permission, primaryjoin=wiki.c.read_permission_id==permission.c.permission_id, backref='wiki_read_access'),
+                            'write_permission': relation(Permission, primaryjoin=wiki.c.write_permission_id==permission.c.permission_id, backref='wiki_write_access'),
+                            'admin_permission': relation(Permission, primaryjoin=wiki.c.admin_permission_id==permission.c.permission_id, backref='wiki_admin_access')})
+
+class WikiItemType(object):
+    def __init__(self, name, mime_type, binary=False, text=False, wiki_text=False):
+        attributes_from_dict(locals())
     
+assign_mapper(sc, WikiItemType, wiki_item_type)
+
+
+class WikiItem(object):
+    def __init__(self, name, version, wiki, item_type, text_content=None, binary_content=None, cache=None):
+        self.name = name
+        self.version = version
+        if isinstance(wiki, Wiki):
+            self.wiki = wiki
+        else:
+            self.wiki_id = wiki
+        if isinstance(item_type, WikiItemType):
+            self.item_type = item_type
+        else:
+            self.item_type = WikiItemType.selectone(WikiItemType.c.name == item_type)
+        
+        if text_content is not None:
+            self.text_content = text_content 
+        if binary_content is not None:
+            self.binary_content = binary_content
+        if cache is not None:
+            self.cache = cache
+
+assign_mapper(sc, WikiItem, wiki_item,
+              properties = {'wiki': relation(Wiki),
+                            'item_type': relation(WikiItemType)})
     
-assign_mapper(sc, DBVersion, db_version)
-assign_mapper(sc, RessourceType, ressource_types)
-assign_mapper(sc, WikiItemType, wiki_item_types)
+class Registry(object):
+    TYPES = {'S': 'value_string',
+             'I': 'value_integer',
+             'B': 'value_boolean',
+             'D': 'value_datetime'}
     
-assign_mapper(sc, User, users)
+    def __init__(self, key, type, value):
+        try:
+            column_name = self.TYPES[type]
+        except KeyError:
+            raise NotImplementedError, 'Registry type "%s" not (yet) implemented' % type
+            
+        setattr(self, column_name, value)
+        self.key = key
+        self.type = type
 
-assign_mapper(sc, Login, logins, 
-              properties = {'user': relation(User, backref=backref('login', uselist=False))})
-
-assign_mapper(sc, Group, groups,
-              properties = {'children': relation(Group, 
-                                primaryjoin=groups.c.id==groups.c.parent_id,
-                                cascade="all"),
-                            'users': relation(User, secondary=user_groups, backref='groups')}) 
+assign_mapper(sc, Registry, wiki_registry,
+              properties = {'wiki': relation(Wiki, backref='registry_items')})
                                 
-assign_mapper(sc, Task, tasks,
-              properties = {'sub_tasks': relation(Task,
-                                secondary=sub_tasks,
-                                primaryjoin=tasks.c.id==sub_tasks.c.super_task_id,
-                                secondaryjoin=sub_tasks.c.sub_task_id==tasks.c.id,
-                                backref='super_tasks')})
-
-assign_mapper(sc, Ressource, ressources,
-              properties = {'ressource_type' : relation(RessourceType)})
-                  
-assign_mapper(sc, LoginTask, login_tasks,
-              properties = {'login': relation(Login, primaryjoin=
-                                login_tasks.c.refers_to_login_id==Login.c.id),
-                            'task': relation(Task, primaryjoin=
-                                login_tasks.c.task_id==Task.c.id),
-                            'group': relation(Group, primaryjoin=
-                                login_tasks.c.group_id==Group.c.id),
-                            'user': relation(User, primaryjoin=
-                                login_tasks.c.user_id==User.c.id),
-                            'ressource': relation(Ressource, primaryjoin=
-                                login_tasks.c.ressource_id==Ressource.c.id)})
+def initialize():
+    from turbogears.database import metadata, get_engine
+    metadata.create_all(engine=get_engine())
     
-Login.mapper.add_property('tasks', relation(LoginTask, primaryjoin=logins.c.id==login_tasks.c.login_id, 
-                                            cascade="all, delete-orphan"))
+    DBVersion('FelloWiki - Base', 1)
     
-assign_mapper(sc, WikiItem, wiki_items,
-              properties = {'ressource': relation(Ressource),
-                            'item_type': relation(WikiItemType)})
+    private_read = Permission('read private wiki', 'read access for the "private" wiki')
+    private_write = Permission('write private wiki', 'write access for the "private" wiki')
+    private_admin = Permission('admin private wiki', 'admin access for the "private" wiki')
+    protected_write = Permission('write protected wiki', 'write access for the "protected" wiki')
+    protected_admin = Permission('admin protected wiki', 'admin access for the "protected" wiki')
+    public_admin = Permission('admin public wiki', 'admin access for the "public" wiki')
+    
+    user_group = Group('Users', 'Users', [public_admin, protected_admin, private_admin])
+    admin_group = Group('Admins', 'Admins', [protected_write, private_write, private_read])
+    
+    admin_user = User('admin', 'Jane Admin', 'password', [user_group, admin_group])
+    user_user = User('user', 'Joe User', 'password', [user_group])
+    
+    wiki_text = WikiItemType('wiki text', 'text/wiki', text = True, wiki_text = True)
+    plain_text = WikiItemType('plain text', 'text/plain', text = True)
+    css_text = WikiItemType('CSS', 'text/css', text = True)
+    jpeg_image = WikiItemType('image: JPEG', 'image/jpeg', binary = True)
+    gif_image = WikiItemType('image: GIF', 'image/gif', binary = True)
+    bmp_image = WikiItemType('image: BMP', 'image/bmp', binary = True)
+    png_image = WikiItemType('image: PNG', 'image/png', binary = True)
+    
+    wiki_private = Wiki('private', 
+                        read_permission=private_read, 
+                        write_permission=private_write,
+                        admin_permission=private_admin)
+    wiki_protected = Wiki('protected', 
+                          write_permission=protected_write,
+                          admin_permission=protected_admin)
+    wiki_public = Wiki('public', 
+                       admin_permission=public_admin)
+                       
+    for wiki in [wiki_private, wiki_protected, wiki_public]:
+        wiki.registry_items.append(Registry('home page', 'S', 'Home Page'))

Modified: trunk/fellowiki/model/schema.py
===================================================================
--- trunk/fellowiki/model/schema.py	2006-09-10 23:39:54 UTC (rev 31)
+++ trunk/fellowiki/model/schema.py	2006-11-19 17:57:44 UTC (rev 32)
@@ -18,6 +18,9 @@
 # FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
 # DEALINGS IN THE SOFTWARE.
 
+
+# TODO: add reference to quickstarted project
+
 from sqlalchemy import *
 
 import turbogears.database
@@ -26,93 +29,90 @@
 
 from datetime import datetime
 
-
 DEFAULT_STRING_LENGTH = 200
 DEFAULT_COMMENT_LENGTH = 2000
 
 
-__all__ = ['db_version', 'users', 'logins', 'groups', 'tasks', 'sub_tasks', 
-           'user_groups', 'ressource_types', 'ressources', 'login_tasks', 
-           'wiki_item_types', 'wiki_items']
+__all__ = ['db_version', 'visit', 'group', 'user', 'permission', 'user_group',
+           'group_permission', 'visit_identity', 'wiki', 'wiki_item_type', 
+           'wiki_item', 'wiki_registry']
 
 db_version = Table('fw_db_version', md,
     Column('prj', Unicode(30), nullable = False, primary_key = True),
     Column('db_version', Integer, nullable = False, primary_key = True),
     Column('installation_date', DateTime, default = datetime.utcnow))
 
-users = Table('fw_users', md,
-    Column('id', Integer, Sequence('fw_user_seq'), primary_key = True, nullable = False),
-    Column('forename', Unicode(DEFAULT_STRING_LENGTH), nullable = False),
-    Column('name', Unicode(DEFAULT_STRING_LENGTH), nullable = False),
-    Column('name_at_birth', Unicode(DEFAULT_STRING_LENGTH)),
-    Column('comment', Unicode(DEFAULT_COMMENT_LENGTH)))
-
-logins = Table('fw_logins', md,
-    Column('id', Integer, Sequence('fw_logins_seq'), primary_key = True, nullable = False),
-    Column('login_name', Unicode(DEFAULT_STRING_LENGTH), nullable = False, unique=True),
-    Column('user_id', Integer, ForeignKey(users.c.id), nullable = True, unique = True),
-    Column('last_change', DateTime, default = datetime.utcnow, nullable = False),
-    Column('password_encoded', Unicode(DEFAULT_STRING_LENGTH), nullable=False),
-    Column('change_at_login', Boolean, nullable = False, default=False))
+visit = Table('fw_visit', md,
+    Column('visit_key', String(40), primary_key=True),
+    Column('created', DateTime, nullable=False, default=datetime.utcnow),
+    Column('expiry', DateTime))
+        
+group = Table('fw_group', md,
+    Column('group_id', Integer, primary_key=True),
+    Column('group_name', Unicode(16), unique=True),
+    Column('display_name', Unicode(DEFAULT_STRING_LENGTH)),
+    Column('created', DateTime, default=datetime.utcnow))
     
-groups = Table('fw_groups', md,
-    Column('id', Integer, Sequence('fw_groups_seq'), primary_key = True, nullable = False),
-    Column('name', Unicode(DEFAULT_STRING_LENGTH), nullable = False, unique=True),
-    Column('parent_id', Integer, ForeignKey('fw_groups.id')),
-    Column('comment', Unicode(DEFAULT_COMMENT_LENGTH)))
-    
-# pre-load:    
-tasks = Table('fw_tasks', md,
-    Column('id', Integer, primary_key = True, nullable = False),
-    Column('name', Unicode(DEFAULT_STRING_LENGTH), nullable = False, unique=True),
-    Column('related_to_group', Boolean, nullable = False),
-    Column('related_to_login', Boolean, nullable = False),
-    Column('related_to_user', Boolean, nullable = False),
-    Column('related_to_ressource', Boolean, nullable = False),
-    Column('comment', Unicode(DEFAULT_COMMENT_LENGTH)))
-    
-sub_tasks = Table('fw_sub_tasks', md,
-    Column('super_task_id', Integer, ForeignKey(tasks.c.id), nullable = False),
-    Column('sub_task_id', Integer, ForeignKey(tasks.c.id), nullable = False))
-    
-user_groups = Table('fw_user_groups', md,
-    Column('user_id', Integer, ForeignKey(users.c.id), nullable = False),
-    Column('group_id', Integer, ForeignKey(groups.c.id), nullable = False))
+user = Table('fw_user', md,
+    Column('user_id', Integer, primary_key=True),
+    Column('user_name', Unicode(16), unique=True),
+    Column('display_name', Unicode(DEFAULT_STRING_LENGTH)),
+    Column('password', Unicode(40)),
+    Column('created', DateTime, default=datetime.utcnow))
 
-# pre-load
-ressource_types = Table('fw_ressource_types', md,
-    Column('id', Integer, primary_key = True, nullable = False),
-    Column('name', Unicode(DEFAULT_STRING_LENGTH), nullable = False, unique = True))
+permission = Table('fw_permission', md,
+    Column('permission_id', Integer, primary_key=True),
+    Column('permission_name', Unicode(16), unique=True),
+    Column('description', Unicode(DEFAULT_STRING_LENGTH)))
 
-ressources = Table('fw_ressources', md,
-    Column('id', Integer, Sequence('fw_ressource_seq'), primary_key = True, nullable = False),
+user_group = Table("fw_user_group", md, 
+    Column("user_id", Integer, ForeignKey(user.c.user_id), primary_key=True),
+    Column("group_id", Integer, ForeignKey(group.c.group_id), primary_key=True))
+
+group_permission = Table("fw_group_permission", md,
+    Column("group_id", Integer, ForeignKey(group.c.group_id), primary_key=True),
+    Column("permission_id", Integer, ForeignKey(permission.c.permission_id), primary_key=True))
+
+visit_identity = Table('fw_visit_identity', md,
+    Column('visit_key', String, ForeignKey(visit.c.visit_key), primary_key=True), # foreign key *not* in quickstarted project
+    Column('user_id', Integer, ForeignKey(user.c.user_id), index=True))
+    
+wiki = Table('fw_wiki', md,
+    Column('wiki_id', Integer, Sequence('fw_wiki_seq'), primary_key = True, nullable = False),
     Column('name', Unicode(DEFAULT_STRING_LENGTH), nullable = False, unique = True),
-    Column('type_id', Integer, ForeignKey(ressource_types.c.id),nullable = False))
-    
-login_tasks = Table('fw_login_tasks', md,
-    Column('id', Integer, Sequence('fw_login_tasks_seq'), primary_key = True, nullable = False),
-    Column('login_id', Integer, ForeignKey(logins.c.id), nullable = False),
-    Column('task_id', Integer, ForeignKey(tasks.c.id), nullable = False),
-    Column('group_id', Integer, ForeignKey(groups.c.id), nullable = True),
-    Column('refers_to_login_id', Integer, ForeignKey(logins.c.id), nullable = True),
-    Column('user_id', Integer, ForeignKey(users.c.id), nullable = True),
-    Column('ressource_id', Integer, ForeignKey(ressources.c.id), nullable = True))
+    Column("read_permission_id", Integer, ForeignKey(permission.c.permission_id)),
+    Column("protect_read_history", Boolean),
+    Column("write_permission_id", Integer, ForeignKey(permission.c.permission_id)),
+    Column("admin_permission_id", Integer, ForeignKey(permission.c.permission_id)))
 
 #pre-load
-wiki_item_types = Table('fw_wiki_item_types', md,
-    Column('id', Integer, Sequence('fw_wiki_item_type_seq'), primary_key = True, nullable = False),
+wiki_item_type = Table('fw_wiki_item_type', md,
+    Column('wiki_item_type_id', Integer, Sequence('fw_wiki_item_type_seq'), primary_key = True, nullable = False),
     Column('name', Unicode(DEFAULT_STRING_LENGTH), unique = True, nullable = False),
-    Column('mime_type', String(DEFAULT_STRING_LENGTH)),
-    Column('parsing_handler', String(DEFAULT_STRING_LENGTH)),
-    Column('binary', Boolean, nullable = False))
+    Column('mime_type', String(DEFAULT_STRING_LENGTH), nullable = False),
+    Column('binary', Boolean, nullable = False),
+    Column('text', Boolean, nullable = False),
+    Column('wiki_text', Boolean, nullable = False))
 
-wiki_items = Table('fw_res_items', md,
-    Column('name', Unicode(DEFAULT_STRING_LENGTH), primary_key = True, nullable = False),
-    Column('version', Integer, primary_key = True, nullable = False),
-    Column('ressource_id', Integer, ForeignKey(ressources.c.id)),
-    Column('type_id', Integer, ForeignKey(wiki_item_types.c.id)),
+wiki_item = Table('fw_wiki_item', md,
+    Column('wiki_item_id', Integer, Sequence('fw_wiki_item_seq'), primary_key = True, nullable = False),
+    Column('name', Unicode(DEFAULT_STRING_LENGTH), unique = 'fw_i_wiki_item_unique', nullable = False),
+    Column('version', Integer, unique = 'fw_i_wiki_item_unique', nullable = False),
+    Column('wiki_id', Integer, ForeignKey(wiki.c.wiki_id), unique = 'fw_i_wiki_item_unique', nullable = False),
+    Column('type_id', Integer, ForeignKey(wiki_item_type.c.wiki_item_type_id), nullable = False),
+    Column('text_content', Unicode),
+    Column('binary_content', Binary),
+    Column('cache', PickleType),
     Column('created', DateTime, default = datetime.utcnow, nullable = False),
-    Column('deleted', DateTime),
-    Column('text_content', Unicode),
-    Column('binary_content', Unicode),
-    Column('parsing_cache', PickleType))
+    Column('deleted', DateTime))
+
+wiki_registry = Table('fw_wiki_registry', md,
+    Column('wiki_registry_id', Integer, Sequence('fw_wiki_registry_seq'), primary_key = True, nullable = False),
+    Column('wiki_id', Integer, ForeignKey(wiki.c.wiki_id), unique = 'fw_wiki_reg_unique'),
+    Column('key', Unicode(DEFAULT_STRING_LENGTH), unique = 'fw_wiki_reg_unique'),
+    Column('type', String(1)),
+    Column('value_string', Unicode(DEFAULT_STRING_LENGTH)),
+    Column('value_integer', Integer),
+    Column('value_boolean', Boolean),
+    Column('value_datetime', DateTime))
+    

Deleted: trunk/fellowiki/templates/default.kid
===================================================================
--- trunk/fellowiki/templates/default.kid	2006-09-10 23:39:54 UTC (rev 31)
+++ trunk/fellowiki/templates/default.kid	2006-11-19 17:57:44 UTC (rev 32)
@@ -1,8 +0,0 @@
-<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml" xmlns:py="http://purl.org/kid/ns#">
-<head>
-<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
-<title><div py:replace='page_title'>Page title.</div></title>
-</head>
-<body><div py:replace='page_body'>Page body.</div></body>
-</html>

Modified: trunk/fellowiki/templates/login.kid
===================================================================
--- trunk/fellowiki/templates/login.kid	2006-09-10 23:39:54 UTC (rev 31)
+++ trunk/fellowiki/templates/login.kid	2006-11-19 17:57:44 UTC (rev 32)
@@ -1,113 +1,77 @@
-<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
-    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml"
-    xmlns:py="http://purl.org/kid/ns#"
-    py:extends="'master.kid'">
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<!--! 
+Copyright (c) 2006 Jan Niklas Fingerle
 
-<head>
-    <meta content="text/html; charset=UTF-8"
-        http-equiv="content-type" py:replace="''"/>
-    <title>Login</title>
-    <style type="text/css">
-        #loginBox
-        {
-            width: 30%;
-            margin: auto;
-            margin-top: 10%;
-            padding-left: 10%;
-            padding-right: 10%;
-            padding-top: 5%;
-            padding-bottom: 5%;
-            font-family: verdana;
-            font-size: 10px;
-            background-color: #eee;
-            border: 2px solid #ccc;
-        }
+This source code file is based on a TurboGears "quickstarted" project.
+The TurboGears framework is copyrighted (c) 2005, 2006 by Kevin Dangoor 
+and contributors.
 
-        #loginBox h1
-        {
-            font-size: 42px;
-            font-family: "Trebuchet MS";
-            margin: 0;
-            color: #ddd;
-        }
+Permission is hereby granted, free of charge, to any person obtaining a
+copy of this software and associated documentation files (the "Software"),
+to deal in the Software without restriction, including without limitation
+the rights to use, copy, modify, merge, publish, distribute, sublicense,
+and/or sell copies of the Software, and to permit persons to whom the
+Software is furnished to do so, subject to the following conditions:
 
-        #loginBox p
-        {
-            position: relative;
-            top: -1.5em;
-            padding-left: 4em;
-            font-size: 12px;
-            margin: 0;
-            color: #666;
-        }
+The above copyright notice and this permission notice shall be included in
+all copies or substantial portions of the Software.
 
-        #loginBox table
-        {
-            table-layout: fixed;
-            border-spacing: 0;
-            width: 100%;
-        }
+THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
+THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
+LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
+FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
+DEALINGS IN THE SOFTWARE.
+-->
 
-        #loginBox td.label
-        {
-            width: 33%;
-            text-align: right;
-        }
+<html xmlns="http://www.w3.org/1999/xhtml"
+      xmlns:py="http://purl.org/kid/ns#"
+      py:extends="'master.kid'">
 
-        #loginBox td.field
-        {
-            width: 66%;
-        }
+    <head>
+        <meta content="text/html; charset=UTF-8"
+              http-equiv="content-type" />
+        <title>Login</title>
+    </head>
 
-        #loginBox td.field input
-        {
-            width: 100%;
-        }
+    <body>
+        <div id="loginBox">
+            <h1>Login</h1>
+            <p>${message}</p>
+            <form action="${previous_url}" method="POST">
+                <table>
+                    <tr>
+                        <td class="label">
+                            <label for="user_name">User Name:</label>
+                        </td>
+                        <td class="field">
+                            <input type="text" id="user_name" name="user_name"/>
+                        </td>
+                    </tr>
+                    <tr>
+                        <td class="label">
+                            <label for="password">Password:</label>
+                        </td>
+                        <td class="field">
+                            <input type="password" 
+                                   id="password" 
+                                   name="password"/>
+                        </td>
+                    </tr>
+                    <tr>
+                        <td colspan="2" class="buttons">
+                            <input type="submit" name="login" value="Login"/>
+                        </td>
+                    </tr>
+                </table>
 
-        #loginBox td.buttons
-        {
-            text-align: right;
-        }
-
-    </style>
-</head>
-
-<body>
-    <div id="loginBox">
-        <h1>Login</h1>
-        <p>${message}</p>
-        <form action="${previous_url}" method="POST">
-            <table>
-                <tr>
-                    <td class="label">
-                        <label for="user_name">User Name:</label>
-                    </td>
-                    <td class="field">
-                        <input type="text" id="user_name" name="user_name"/>
-                    </td>
-                </tr>
-                <tr>
-                    <td class="label">
-                        <label for="password">Password:</label>
-                    </td>
-                    <td class="field">
-                        <input type="password" id="password" name="password"/>
-                    </td>
-                </tr>
-                <tr>
-                    <td colspan="2" class="buttons">
-                        <input type="submit" name="login" value="Login"/>
-                    </td>
-                </tr>
-            </table>
-
-            <input py:if="forward_url" type="hidden" name="forward_url"
-                value="${forward_url}"/>
+                <input py:if="forward_url" type="hidden" name="forward_url"
+                       value="${forward_url}"/>
                 
-            <input py:for="name,value in original_parameters.items()"
-                type="hidden" name="${name}" value="${value}"/>
-        </form>
-    </div>
-</body>
+                <input py:for="name,value in original_parameters.items()"
+                       type="hidden" name="${name}" value="${value}"/>
+            </form>
+        </div>
+    </body>
 </html>

Modified: trunk/fellowiki/templates/master.kid
===================================================================
--- trunk/fellowiki/templates/master.kid	2006-09-10 23:39:54 UTC (rev 31)
+++ trunk/fellowiki/templates/master.kid	2006-11-19 17:57:44 UTC (rev 32)
@@ -1,46 +1,53 @@
-<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<?python import sitetemplate ?>
-<html xmlns="http://www.w3.org/1999/xhtml" xmlns:py="http://purl.org/kid/ns#" py:extends="sitetemplate">
-
-<head py:match="item.tag=='{http://www.w3.org/1999/xhtml}head'" py:attrs="item.items()">
-    <meta content="text/html; charset=UTF-8" http-equiv="content-type" py:replace="''"/>
-    <title py:replace="''">Your title goes here</title>
-    <meta py:replace="item[:]"/>
-    <style type="text/css">
-        #pageLogin
-        {
-            font-size: 10px;
-            font-family: verdana;
-            text-align: right;
-        }
-    </style>
-    <style type="text/css" media="screen">
- at import "/static/css/style.css";
-</style>
-</head>
-
-<body py:match="item.tag=='{http://www.w3.org/1999/xhtml}body'" py:attrs="item.items()">
-    <div py:if="tg.config('identity.on',False) and not 'logging_in' in locals()"
-        id="pageLogin">
-        <span py:if="tg.identity.anonymous">
-            <a href="/login">Login</a>
-        </span>
-        <span py:if="not tg.identity.anonymous">
-            Welcome ${tg.identity.user.display_name}.
-            <a href="/logout">Logout</a>
-        </span>
-    </div>
-
-    <div py:if="tg_flash" class="flash" py:content="tg_flash"></div>
-
-    <div py:replace="[item.text]+item[:]"/>
-
-	<!-- End of main_content -->
-<div id="footer"> <img src="/static/images/under_the_hood_blue.png" />
-  <p>TurboGears is a open source front-to-back web development
-    framework written in Python</p>
-  <p>Copyright &copy; 2006 Kevin Dangoor</p>
-</div>
-</body>
-
-</html>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<!--! 
+Copyright (c) 2006 Jan Niklas Fingerle
+
+This source code file is based on a TurboGears "quickstarted" project.
+The TurboGears framework is copyrighted (c) 2005, 2006 by Kevin Dangoor 
+and contributors.
+
+Permission is hereby granted, free of charge, to any person obtaining a
+copy of this software and associated documentation files (the "Software"),
+to deal in the Software without restriction, including without limitation
+the rights to use, copy, modify, merge, publish, distribute, sublicense,
+and/or sell copies of the Software, and to permit persons to whom the
+Software is furnished to do so, subject to the following conditions:
+
+The above copyright notice and this permission notice shall be included in
+all copies or substantial portions of the Software.
+
+THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
+THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
+LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
+FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
+DEALINGS IN THE SOFTWARE.
+-->
+
+<?python import sitetemplate ?>
+
+<html xmlns="http://www.w3.org/1999/xhtml" xmlns:py="http://purl.org/kid/ns#" py:extends="sitetemplate">
+
+    <head py:match="item.tag=='{http://www.w3.org/1999/xhtml}head'" py:attrs="item.items()">
+        <title py:replace="''">Your title goes here</title>
+        <meta py:replace="item[:]"/>
+        <style type="text/css">
+            #pageLogin
+            {
+                font-size: 10px;
+                font-family: verdana;
+                text-align: right;
+            }
+        </style>
+        <style type="text/css" media="screen">
+            @import "/static/css/style.css";
+        </style>
+    </head>
+
+    <body py:match="item.tag=='{http://www.w3.org/1999/xhtml}body'" py:attrs="item.items()">
+        <div py:if="tg_flash" class="flash" py:content="tg_flash"/>
+        <div py:replace="[item.text]+item[:]"/>
+    </body>
+
+</html>

Deleted: trunk/fellowiki/templates/welcome.kid
===================================================================
--- trunk/fellowiki/templates/welcome.kid	2006-09-10 23:39:54 UTC (rev 31)
+++ trunk/fellowiki/templates/welcome.kid	2006-11-19 17:57:44 UTC (rev 32)
@@ -1,50 +0,0 @@
-<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml" xmlns:py="http://purl.org/kid/ns#"
-    py:extends="'master.kid'">
-<head>
-<meta content="text/html; charset=utf-8" http-equiv="Content-Type" py:replace="''"/>
-<title>Welcome to TurboGears</title>
-</head>
-<body>
-<div id="header">&nbsp;</div>
-<div id="main_content">
-  <div id="status_block">Your TurboGears application is now running.</div>
-  <!--h1>Take steps to dive right in:</h1-->
-  <div id="sidebar">
-    <h2>Learn more</h2>
-    Learn more about TurboGears and take part in its
-    development
-    <ul class="links">
-      <li><a href="http://www.turbogears.org">Official website</a></li>
-      <li><a href="http://docs.turbogears.org">Documentation</a></li>
-      <li><a href="http://trac.turbogears.org/turbogears/">Trac
-        (bugs/suggestions)</a></li>
-      <li><a href="http://groups.google.com/group/turbogears"> Mailing list</a> </li>
-    </ul>
-  </div>
-  <div id="getting_started">
-    <ol id="getting_started_steps">
-      <li class="getting_started">
-        <h3>Model</h3>
-        <p> <a href="http://docs.turbogears.org/1.0/GettingStarted/DefineDatabase">Design models</a> in the <span class="code">model.py</span>.<br/>
-          Edit <span class="code">dev.cfg</span> to <a href="http://docs.turbogears.org/1.0/GettingStarted/UseDatabase">use a different backend</a>, or start with a pre-configured SQLite database. <br/>
-          Use script <span class="code">tg-admin sql create</span> to create the database tables.</p>
-      </li>
-      <li class="getting_started">
-        <h3>View</h3>
-        <p> Edit <a href="http://docs.turbogears.org/1.0/GettingStarted/Kid">html-like templates</a> in the <span class="code">/templates</span> folder;<br/>
-        Put all <a href="http://docs.turbogears.org/1.0/StaticFiles">static contents</a> in the <span class="code">/static</span> folder. </p>
-      </li>
-      <li class="getting_started">
-        <h3>Controller</h3>
-        <p> Edit <span class="code"> controllers.py</span> and <a href="http://docs.turbogears.org/1.0/GettingStarted/CherryPy">build your
-          website structure</a> with the simplicity of Python objects. <br/>
-          TurboGears will automatically reload itself when you modify your project. </p>
-      </li>
-    </ol>
-    <div class="notice"> If you create something cool, please <a href="http://groups.google.com/group/turbogears">let people know</a>, and consider contributing something back to the <a href="http://groups.google.com/group/turbogears">community</a>.</div>
-  </div>
-  <!-- End of getting_started -->
-</div>
-</body>
-</html>

Added: trunk/fellowiki/templates/wiki_edit.kid
===================================================================
--- trunk/fellowiki/templates/wiki_edit.kid	2006-09-10 23:39:54 UTC (rev 31)
+++ trunk/fellowiki/templates/wiki_edit.kid	2006-11-19 17:57:44 UTC (rev 32)
@@ -0,0 +1,17 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml" xmlns:py="http://purl.org/kid/ns#"
+    py:extends="'master.kid'">
+<head>
+<title>Title</title>
+</head>
+<body>
+<h1>Preview</h1>
+${preview}
+
+<h1>Edit</h1>
+
+    <p py:content="form(data)">Comment form</p>
+
+
+</body>
+</html>

Added: trunk/fellowiki/templates/wiki_view.kid
===================================================================
--- trunk/fellowiki/templates/wiki_view.kid	2006-09-10 23:39:54 UTC (rev 31)
+++ trunk/fellowiki/templates/wiki_view.kid	2006-11-19 17:57:44 UTC (rev 32)
@@ -0,0 +1,16 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+
+<html xmlns="http://www.w3.org/1999/xhtml" 
+      xmlns:py="http://purl.org/kid/ns#"
+      py:extends="'master.kid'">
+
+    <head>
+        <title>${title}</title>
+    </head>
+    <body>
+        <h1 class='page_name'><span py:replace="page_name">This is the page name</span></h1>
+        <div class='main_content'><span py:replace="main_content">This ist the wiki page main content</span></div>
+        <hr />
+        <a href="${edit_link}" py:if="page_is_editable">edit this page</a>
+    </body>
+</html>

Modified: trunk/fellowiki/util/assorted.py
===================================================================
--- trunk/fellowiki/util/assorted.py	2006-09-10 23:39:54 UTC (rev 31)
+++ trunk/fellowiki/util/assorted.py	2006-11-19 17:57:44 UTC (rev 32)
@@ -27,11 +27,13 @@
 """
 
 import re
+from turbogears import identity
 
 # TODO: howto support CElementTree (portably!, utf8-support?)
 
 from elementtree.ElementTree import Element
 
+
 def attributes_from_dict(dict_):
     """initialize class instance from __init__ arguments
 
@@ -74,12 +76,12 @@
              ignored.
 
     """
-    
+
     # The tricky thing is, that the last text (non-element) content of etree_1
     # resides in the ".tail" of the last contained element if there is one. 
     # Otherwise, the ".text" is the only content, therefore it is the last
     # text content.
-    
+
     ret = Element(ret_type)
     if len(etree_1) == 0:
         ret.text = save_add(etree_1.text, etree_2.text)
@@ -90,3 +92,10 @@
         ret.text = etree_1.text
         ret[:] = etree_1[:-1] + [last_sub] + etree_2[:]
     return ret
+
+def check_for_permission(perm):
+    """check for a permission explicitly"""
+    if not (perm is None or
+            perm in identity.current.permissions):
+        raise identity.IdentityFailure, "don't have permission %s" % perm
+        

Added: trunk/fellowiki/util/xmlelement.py
===================================================================
--- trunk/fellowiki/util/xmlelement.py	2006-09-10 23:39:54 UTC (rev 31)
+++ trunk/fellowiki/util/xmlelement.py	2006-11-19 17:57:44 UTC (rev 32)
@@ -0,0 +1,130 @@
+# pylint: disable-msg=W0613,E0201
+# W0702, W0706: allow argument magic (i.e. attributes_from_dict())
+
+# Copyright (c) 2006 Jan Niklas Fingerle
+# 
+# Permission is hereby granted, free of charge, to any person obtaining a
+# copy of this software and associated documentation files (the "Software"),
+# to deal in the Software without restriction, including without limitation
+# the rights to use, copy, modify, merge, publish, distribute, sublicense,
+# and/or sell copies of the Software, and to permit persons to whom the
+# Software is furnished to do so, subject to the following conditions:
+#
+# The above copyright notice and this permission notice shall be included in
+# all copies or substantial portions of the Software.
+#
+# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
+# THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
+# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
+# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
+# DEALINGS IN THE SOFTWARE.
+
+"""
+
+TODO
+    
+"""
+
+from copy import copy
+import elementtree.ElementTree as ElementTree
+        
+class XMLElement(object):
+    def __init__(self, tag = None, content=None, prepend_to=None,
+                 append_to=None, **attributes):
+        self.tag = tag
+        if content is None:
+            self.content = []
+        else:
+            try:
+                content.pop # check if it's a kind of list
+                self.content = content
+            except AttributeError:
+                self.content = [content]
+        self.attributes = {}
+        
+        for (key, val) in attributes.items():
+            if key[-1:] == '_':
+                self.attributes[key[:-1]] = val
+            else:
+                self.attributes[key] = val
+            
+        self.callback = []
+        self.translations = []
+        
+        if prepend_to is not None:
+            prepend_to.prepend(self)
+        if append_to is not None:
+            append_to.append(self)
+        
+    def clone(self, other):
+        self.tag = other.tag
+        self.content = other.content
+        self.attributes = other.attributes
+        self.callback = other.callback
+        self.translations = other.translations
+        
+    def to_element_tree(self): 
+        xhtml = ElementTree.Element(self.tag)
+        sub_xhtml = None
+        current_textlist = []
+        content = copy(self.content)
+        translations = []
+        
+        for (key, val) in self.attributes.items():
+            xhtml.set(key, str(val))
+        
+        # I want to modify the list, therefore I write this a bit 
+        # more explicitly:
+        while content:
+            item = content.pop(0) 
+            try: # should work, if it's a text list
+                current_textlist.extend(item)
+            except TypeError: # should be an XMLElement
+                if item.tag is None:
+                    content = item.content + content
+                else:
+                    current_text = ''.join(current_textlist)
+                    current_textlist = []
+                    if sub_xhtml is None:
+                        xhtml.text = current_text
+                    else:
+                        sub_xhtml.tail = current_text
+                    sub_xhtml, sub_translations = item.to_element_tree()
+                    xhtml.append(sub_xhtml)
+                    translations.extend(sub_translations)
+        current_text = ''.join(current_textlist)
+        if sub_xhtml is None:
+            xhtml.text = current_text
+        else:
+            sub_xhtml.tail = current_text
+        for translation in self.translations:
+            if translation[1] is None:
+                translations.append((xhtml, 
+                                     translation[0], 
+                                     translation[2]))
+            else:
+                translation[1](xhtml, translation[2])
+        return xhtml, translations
+        
+    def is_empty(self):
+        return not bool(self.content)
+        
+    def is_not_empty(self):
+        return bool(self.content)
+            
+    def append(self, *appendee):
+        self.content.extend(appendee)
+    
+    def prepend(self, *prependee):
+        self.content = list(prependee) + self.content
+        
+    def set(self, key, val):
+        self.attributes[key] = val
+        
+    def get(self, key):
+        return self.attributes[key]
+        
+def SubElement(parent, *args, **kwargs):
+    return XMLElement(append_to=parent, *args, **kwargs)

Added: trunk/fellowiki/widgets/__init__.py
===================================================================
--- trunk/fellowiki/widgets/__init__.py	2006-09-10 23:39:54 UTC (rev 31)
+++ trunk/fellowiki/widgets/__init__.py	2006-11-19 17:57:44 UTC (rev 32)
@@ -0,0 +1,19 @@
+# Copyright (c) 2006 Jan Niklas Fingerle
+# 
+# Permission is hereby granted, free of charge, to any person obtaining a
+# copy of this software and associated documentation files (the "Software"),
+# to deal in the Software without restriction, including without limitation
+# the rights to use, copy, modify, merge, publish, distribute, sublicense,
+# and/or sell copies of the Software, and to permit persons to whom the
+# Software is furnished to do so, subject to the following conditions:
+#
+# The above copyright notice and this permission notice shall be included in
+# all copies or substantial portions of the Software.
+#
+# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
+# THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
+# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
+# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
+# DEALINGS IN THE SOFTWARE.

Added: trunk/fellowiki/widgets/forms.py
===================================================================
--- trunk/fellowiki/widgets/forms.py	2006-09-10 23:39:54 UTC (rev 31)
+++ trunk/fellowiki/widgets/forms.py	2006-11-19 17:57:44 UTC (rev 32)
@@ -0,0 +1,71 @@
+# Copyright (c) 2006 Jan Niklas Fingerle
+# 
+# This source code file is based on the TurboGears project's code.
+# The TurboGears framework is copyrighted (c) 2005, 2006 by Kevin Dangoor 
+# and contributors.
+#
+# Permission is hereby granted, free of charge, to any person obtaining a
+# copy of this software and associated documentation files (the "Software"),
+# to deal in the Software without restriction, including without limitation
+# the rights to use, copy, modify, merge, publish, distribute, sublicense,
+# and/or sell copies of the Software, and to permit persons to whom the
+# Software is furnished to do so, subject to the following conditions:
+#
+# The above copyright notice and this permission notice shall be included in
+# all copies or substantial portions of the Software.
+#
+# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
+# THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
+# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
+# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
+# DEALINGS IN THE SOFTWARE.
+
+import turbogears.widgets as w
+
+class SubmitPreviewForm(w.Form):
+    name = 'submit_preview_form'
+    member_widgets = ['preview', 'reset']
+    params = ['preview_text', 'reset_text']
+    params_doc = {'preview_text': 'Text for the preview button',
+                  'reset_text': 'Text for the reset button'}
+    preview = w.SubmitButton(name='preview')
+    reset = w.ResetButton()
+    
+    
+class SubmitPreviewTableForm(SubmitPreviewForm):
+    template = """
+    <form xmlns:py="http://purl.org/kid/ns#"
+        name="${name}"
+        action="${action}"
+        method="${method}"
+        class="tableform"
+        py:attrs="form_attrs"
+    >
+        <div py:for="field in hidden_fields"
+            py:replace="field.display(value_for(field), **params_for(field))"
+        />
+        <table border="0" cellspacing="0" cellpadding="2" py:attrs="table_attrs">
+            <tr py:for="i, field in enumerate(fields)"
+                class="${i%2 and 'odd' or 'even'}"
+            >
+                <th>
+                    <label class="fieldlabel" for="${field.field_id}" py:content="field.label" />
+                </th>
+                <td>
+                    <span py:replace="field.display(value_for(field), **params_for(field))" />
+                    <span py:if="error_for(field)" class="fielderror" py:content="error_for(field)" />
+                    <span py:if="field.help_text" class="fieldhelp" py:content="field.help_text" />
+                </td>
+            </tr>
+            <tr>
+                <td>&#160;</td>
+                <td>${submit.display(submit_text)} ${preview.display(preview_text)} ${reset.display(reset_text)}</td>
+            </tr>
+        </table>
+    </form>
+    """
+    params = ["table_attrs"]
+    params_doc = {'table_attrs' : 'Extra (X)HTML attributes for the Table tag'}
+    table_attrs = {}

Copied: trunk/fellowiki-www.py (from rev 31, trunk/fellowiki.py)
===================================================================
--- trunk/fellowiki.py	2006-09-10 23:39:54 UTC (rev 31)
+++ trunk/fellowiki-www.py	2006-11-19 17:57:44 UTC (rev 32)
@@ -0,0 +1,125 @@
+#!/usr/bin/python2.4
+# Copyright (c) 2006 Jan Niklas Fingerle
+#
+# This source code file is based on a TurboGears "quickstarted" project.
+# The TurboGears framework is copyrighted (c) 2005, 2006 by Kevin Dangoor 
+# and contributors.
+# 
+# Permission is hereby granted, free of charge, to any person obtaining a
+# copy of this software and associated documentation files (the "Software"),
+# to deal in the Software without restriction, including without limitation
+# the rights to use, copy, modify, merge, publish, distribute, sublicense,
+# and/or sell copies of the Software, and to permit persons to whom the
+# Software is furnished to do so, subject to the following conditions:
+#
+# The above copyright notice and this permission notice shall be included in
+# all copies or substantial portions of the Software.
+#
+# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
+# THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
+# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
+# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
+# DEALINGS IN THE SOFTWARE.
+
+import pkg_resources
+pkg_resources.require("TurboGears")
+
+from optparse import OptionParser
+from os.path import join, exists, dirname
+
+import cherrypy
+import turbogears
+from turbogears.database import session
+from sqlalchemy.exceptions import SQLError
+
+from fellowiki.model import DBVersion, initialize
+
+def get_configuration():
+    parser = OptionParser()
+    parser.add_option("-c", "--config", dest="config_file", type='string',
+                  help="read configuration from FILE", metavar="FILE")
+    parser.add_option("-u", "--database ", dest="db_uri", type='string',
+                  help="data base URI", metavar="URI")
+    parser.add_option("-b", "--bind", dest="server_host", type='string',
+                  help="bind server to HOST", metavar="HOST")
+    parser.add_option("-p", "--port", dest="server_port", type='int',
+                  help="bind server to PORT", metavar="PORT")
+    parser.add_option("--generate-tables", dest="generate_tables", 
+                  action='store_true', default=False,
+                  help="generate fellowiki data base tables")
+    parser.add_option("--update-tables", dest="update_tables", 
+                  action='store_true', default=False,
+                  help="update fellowiki data base tables - not yet supported")
+                  
+    (options, args) = parser.parse_args()
+    
+    if len(args) <> 0:
+        parser.error("positional parameters supplied, but not expected")
+                      
+    return options
+
+
+def check_database(options):
+    cherrypy.log('DB URI is %s' % cherrypy.config.get('sqlalchemy.dburi'), 'DB', 0)
+    if cherrypy.config.get('sqlalchemy.dburi') in ['sqlite://', 'sqlite://:memory:', 
+                                         'sqlite:///', 'sqlite:///:memory:']:
+        # SQLite data bases require one DBApi per Thread. Cherrypy is 
+        # multithreaded. Each thread will get its own *empty* memory DB, which
+        # is not what we want, therefore...
+        cherrypy.log("FelloWiki does not support SQLite memory data bases.", 'DB', 2)
+        return False
+    
+    try: 
+        versions = DBVersion.select()
+        if options.generate_tables:
+            cherrypy.log('generation of data base tables requested, but '+
+                         'schema version table exists', 'DB', 1)
+            return True
+    except SQLError:
+        if options.generate_tables:
+            cherrypy.log('generating data base tables, as requested', 'DB', 0)
+            initialize()
+            session.flush()
+            
+        else:
+            cherrypy.log("The FelloWiki data base tables seem not to be " 
+                         + "installed. Please run FelloWiki with the flag " 
+                         + "'--generate-tables' to create all needed tables.", 'DB', 2)
+            return False
+        
+    return True
+
+def config_turbogears(options):
+    if options.config_file is not None:
+        turbogears.config.update_config(configfile=options.config_file, 
+            modulename="fellowiki.config")
+    elif exists(join(dirname(__file__), "setup.py")):
+        turbogears.config.update_config(configfile=join(dirname(__file__), "dev.cfg"),
+            modulename="fellowiki.config")
+    elif exists("/etc/fellowiki.cfg"):
+        turbogears.config.update_config(configfile="/etc/fellowiki.cfg",
+            modulename="fellowiki.config")
+
+    new_conf = {}
+    
+    if options.server_host is not None:
+        new_conf['server.socket_host'] = options.server_host
+    if options.server_port is not None:
+        new_conf['server.socket_port'] = options.server_port
+    if options.db_uri is not None:   
+        new_conf['sqlalchemy.dburi'] = options.db_uri
+        
+    turbogears.config.update({'global': new_conf})
+
+
+def start_web_server():
+    options = get_configuration()
+    config_turbogears(options)
+    if check_database(options):
+        from fellowiki.controllers import FelloWikiRoot
+        turbogears.start_server(FelloWikiRoot())
+      
+if __name__ == '__main__':
+    start_web_server()

Deleted: trunk/fellowiki.py
===================================================================
--- trunk/fellowiki.py	2006-09-10 23:39:54 UTC (rev 31)
+++ trunk/fellowiki.py	2006-11-19 17:57:44 UTC (rev 32)
@@ -1,130 +0,0 @@
-#!/usr/bin/python2.4
-# Copyright (c) 2006 Jan Niklas Fingerle
-#
-# This source code file is based on a TurboGears "quickstarted" project.
-# The TurboGears framework is copyrighted (c) 2005, 2006 by Kevin Dangoor 
-# and contributors.
-# 
-# Permission is hereby granted, free of charge, to any person obtaining a
-# copy of this software and associated documentation files (the "Software"),
-# to deal in the Software without restriction, including without limitation
-# the rights to use, copy, modify, merge, publish, distribute, sublicense,
-# and/or sell copies of the Software, and to permit persons to whom the
-# Software is furnished to do so, subject to the following conditions:
-#
-# The above copyright notice and this permission notice shall be included in
-# all copies or substantial portions of the Software.
-#
-# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
-# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
-# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
-# THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
-# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
-# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
-# DEALINGS IN THE SOFTWARE.
-
-import pkg_resources
-pkg_resources.require("TurboGears")
-
-from optparse import OptionParser
-from os.path import join, exists, dirname
-
-import cherrypy
-import turbogears
-from sqlalchemy.exceptions import SQLError
-
-from fellowiki.model import DBVersion
-
-def get_configuration():
-    parser = OptionParser()
-    parser.add_option("-c", "--config", dest="config_file", type='string',
-                  help="read configuration from FILE", metavar="FILE")
-    parser.add_option("-u", "--database ", dest="db_uri", type='string',
-                  help="data base URI", metavar="URI")
-    parser.add_option("-b", "--bind", dest="server_host", type='string',
-                  help="bind server to HOST", metavar="HOST")
-    parser.add_option("-p", "--port", dest="server_port", type='int',
-                  help="bind server to PORT", metavar="PORT")
-    parser.add_option("--generate-tables", dest="generate_tables", 
-                  action='store_true', default=False,
-                  help="generate fellowiki data base tables")
-    parser.add_option("--update-tables", dest="update_tables", 
-                  action='store_true', default=False,
-                  help="update fellowiki data base tables - not yet supported")
-                  
-    (options, args) = parser.parse_args()
-    
-    if len(args) <> 0:
-        parser.error("positional parameters supplied, but not expected")
-                      
-    return options
-
-
-def check_database(options):
-    cherrypy.log('DB URI is %s' % cherrypy.config.get('sqlalchemy.dburi'), 'DB', 0)
-    if cherrypy.config.get('sqlalchemy.dburi') in ['sqlite://', 'sqlite://:memory:', 
-                                         'sqlite:///', 'sqlite:///:memory:']:
-        # SQLite data bases require one DBApi per Thread. Cherrypy is 
-        # multithreaded. Each thread will get its own *empty* memory DB, which
-        # is not what we want, therefore...
-        cherrypy.log("FelloWiki does not support SQLite memory data bases.", 'DB', 2)
-        return False
-    
-    try: 
-        versions = DBVersion.select()
-        if options.generate_tables:
-            cherrypy.log('generation of data base tables requested, but '+
-                         'schema version table exists', 'DB', 1)
-            return True
-    except SQLError:
-        if options.generate_tables:
-            cherrypy.log('generating data base tables, as requested', 'DB', 0)
-            
-            from turbogears.database import metadata, get_engine, session
-            
-            engine = get_engine()
-            
-            metadata.create_all(engine=engine)
-            DBVersion('FelloWiki - Base', 1)
-            session.flush()
-            
-        else:
-            cherrypy.log("The FelloWiki data base tables seem not to be " 
-                         + "installed. Please run FelloWiki with the flag " 
-                         + "'--generate-tables' to create all needed tables.", 'DB', 2)
-            return False
-        
-    return True
-
-def config_turbogears(options):
-    if options.config_file is not None:
-        turbogears.config.update_config(configfile=options.config_file, 
-            modulename="fellowiki.config")
-    elif exists(join(dirname(__file__), "setup.py")):
-        turbogears.config.update_config(configfile=join(dirname(__file__), "dev.cfg"),
-            modulename="fellowiki.config")
-    elif exists("/etc/fellowiki.cfg"):
-        turbogears.config.update_config(configfile="/etc/fellowiki.cfg",
-            modulename="fellowiki.config")
-
-    new_conf = {}
-    
-    if options.server_host is not None:
-        new_conf['server.socket_host'] = options.server_host
-    if options.server_port is not None:
-        new_conf['server.socket_port'] = options.server_port
-    if options.db_uri is not None:   
-        new_conf['sqlalchemy.dburi'] = options.db_uri
-        
-    turbogears.config.update({'global': new_conf})
-
-
-def start_web_server():
-    options = get_configuration()
-    config_turbogears(options)
-    if check_database(options):
-        from fellowiki.controllers import FelloWikiRoot
-        turbogears.start_server(FelloWikiRoot())
-      
-if __name__ == '__main__':
-    start_web_server()

Modified: trunk/setup.py
===================================================================
--- trunk/setup.py	2006-09-10 23:39:54 UTC (rev 31)
+++ trunk/setup.py	2006-11-19 17:57:44 UTC (rev 32)
@@ -32,7 +32,7 @@
 
 setup(
     name="FelloWiki",
-    version="pre0.01",
+    version="0.01-dev20061118",
     
     description='Yet another wiki engine',
     long_description='Yet another wiki engine - still heavily in alpha',
@@ -46,7 +46,7 @@
     install_requires = [
         "TurboGears >= 1.0b1",
     ],
-    scripts = ["start-fellowiki.py"],
+    scripts = ["fellowiki.py"],
     zip_safe=False,
     packages=find_packages(),
     package_data = find_package_data(where='fellowiki',



From fingerle at mail.berlios.de  Sun Nov 19 19:58:47 2006
From: fingerle at mail.berlios.de (fingerle at BerliOS)
Date: Sun, 19 Nov 2006 19:58:47 +0100
Subject: [fellowiki-svncheckins] r33 - pjm trunk
Message-ID: <200611191858.kAJIwlNj023274@sheep.berlios.de>

Author: fingerle
Date: 2006-11-19 19:58:47 +0100 (Sun, 19 Nov 2006)
New Revision: 33

Added:
   trunk/fellowiki.py
Removed:
   trunk/fellowiki-www.py
Modified:
   pjm/milestones.txt
   trunk/setup.py
Log:
moved fellowiki-www.py to fellowiki.py and minor changes


Modified: pjm/milestones.txt
===================================================================
--- pjm/milestones.txt	2006-11-19 17:57:44 UTC (rev 32)
+++ pjm/milestones.txt	2006-11-19 18:58:47 UTC (rev 33)
@@ -1,3 +1,5 @@
+This file is heavily out of date.
+
 achieved:
 =========
 

Deleted: trunk/fellowiki-www.py
===================================================================
--- trunk/fellowiki-www.py	2006-11-19 17:57:44 UTC (rev 32)
+++ trunk/fellowiki-www.py	2006-11-19 18:58:47 UTC (rev 33)
@@ -1,125 +0,0 @@
-#!/usr/bin/python2.4
-# Copyright (c) 2006 Jan Niklas Fingerle
-#
-# This source code file is based on a TurboGears "quickstarted" project.
-# The TurboGears framework is copyrighted (c) 2005, 2006 by Kevin Dangoor 
-# and contributors.
-# 
-# Permission is hereby granted, free of charge, to any person obtaining a
-# copy of this software and associated documentation files (the "Software"),
-# to deal in the Software without restriction, including without limitation
-# the rights to use, copy, modify, merge, publish, distribute, sublicense,
-# and/or sell copies of the Software, and to permit persons to whom the
-# Software is furnished to do so, subject to the following conditions:
-#
-# The above copyright notice and this permission notice shall be included in
-# all copies or substantial portions of the Software.
-#
-# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
-# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
-# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
-# THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
-# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
-# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
-# DEALINGS IN THE SOFTWARE.
-
-import pkg_resources
-pkg_resources.require("TurboGears")
-
-from optparse import OptionParser
-from os.path import join, exists, dirname
-
-import cherrypy
-import turbogears
-from turbogears.database import session
-from sqlalchemy.exceptions import SQLError
-
-from fellowiki.model import DBVersion, initialize
-
-def get_configuration():
-    parser = OptionParser()
-    parser.add_option("-c", "--config", dest="config_file", type='string',
-                  help="read configuration from FILE", metavar="FILE")
-    parser.add_option("-u", "--database ", dest="db_uri", type='string',
-                  help="data base URI", metavar="URI")
-    parser.add_option("-b", "--bind", dest="server_host", type='string',
-                  help="bind server to HOST", metavar="HOST")
-    parser.add_option("-p", "--port", dest="server_port", type='int',
-                  help="bind server to PORT", metavar="PORT")
-    parser.add_option("--generate-tables", dest="generate_tables", 
-                  action='store_true', default=False,
-                  help="generate fellowiki data base tables")
-    parser.add_option("--update-tables", dest="update_tables", 
-                  action='store_true', default=False,
-                  help="update fellowiki data base tables - not yet supported")
-                  
-    (options, args) = parser.parse_args()
-    
-    if len(args) <> 0:
-        parser.error("positional parameters supplied, but not expected")
-                      
-    return options
-
-
-def check_database(options):
-    cherrypy.log('DB URI is %s' % cherrypy.config.get('sqlalchemy.dburi'), 'DB', 0)
-    if cherrypy.config.get('sqlalchemy.dburi') in ['sqlite://', 'sqlite://:memory:', 
-                                         'sqlite:///', 'sqlite:///:memory:']:
-        # SQLite data bases require one DBApi per Thread. Cherrypy is 
-        # multithreaded. Each thread will get its own *empty* memory DB, which
-        # is not what we want, therefore...
-        cherrypy.log("FelloWiki does not support SQLite memory data bases.", 'DB', 2)
-        return False
-    
-    try: 
-        versions = DBVersion.select()
-        if options.generate_tables:
-            cherrypy.log('generation of data base tables requested, but '+
-                         'schema version table exists', 'DB', 1)
-            return True
-    except SQLError:
-        if options.generate_tables:
-            cherrypy.log('generating data base tables, as requested', 'DB', 0)
-            initialize()
-            session.flush()
-            
-        else:
-            cherrypy.log("The FelloWiki data base tables seem not to be " 
-                         + "installed. Please run FelloWiki with the flag " 
-                         + "'--generate-tables' to create all needed tables.", 'DB', 2)
-            return False
-        
-    return True
-
-def config_turbogears(options):
-    if options.config_file is not None:
-        turbogears.config.update_config(configfile=options.config_file, 
-            modulename="fellowiki.config")
-    elif exists(join(dirname(__file__), "setup.py")):
-        turbogears.config.update_config(configfile=join(dirname(__file__), "dev.cfg"),
-            modulename="fellowiki.config")
-    elif exists("/etc/fellowiki.cfg"):
-        turbogears.config.update_config(configfile="/etc/fellowiki.cfg",
-            modulename="fellowiki.config")
-
-    new_conf = {}
-    
-    if options.server_host is not None:
-        new_conf['server.socket_host'] = options.server_host
-    if options.server_port is not None:
-        new_conf['server.socket_port'] = options.server_port
-    if options.db_uri is not None:   
-        new_conf['sqlalchemy.dburi'] = options.db_uri
-        
-    turbogears.config.update({'global': new_conf})
-
-
-def start_web_server():
-    options = get_configuration()
-    config_turbogears(options)
-    if check_database(options):
-        from fellowiki.controllers import FelloWikiRoot
-        turbogears.start_server(FelloWikiRoot())
-      
-if __name__ == '__main__':
-    start_web_server()

Copied: trunk/fellowiki.py (from rev 32, trunk/fellowiki-www.py)

Modified: trunk/setup.py
===================================================================
--- trunk/setup.py	2006-11-19 17:57:44 UTC (rev 32)
+++ trunk/setup.py	2006-11-19 18:58:47 UTC (rev 33)
@@ -41,7 +41,6 @@
     #url='http://www.fellowiki.org',
     #download_url='http://download.fellowiki.org',
     license='MIT-style',
-    copyright = "(c) 2006 Jan Niklas Fingerle",
     
     install_requires = [
         "TurboGears >= 1.0b1",



From fingerle at mail.berlios.de  Wed Nov 22 01:38:17 2006
From: fingerle at mail.berlios.de (fingerle at BerliOS)
Date: Wed, 22 Nov 2006 01:38:17 +0100
Subject: [fellowiki-svncheckins] r34 - trunk
Message-ID: <200611220038.kAM0cH5w012581@sheep.berlios.de>

Author: fingerle
Date: 2006-11-22 01:38:16 +0100 (Wed, 22 Nov 2006)
New Revision: 34

Modified:
   trunk/setup.py
Log:
changes for setuptools


Modified: trunk/setup.py
===================================================================
--- trunk/setup.py	2006-11-19 18:58:47 UTC (rev 33)
+++ trunk/setup.py	2006-11-22 00:38:16 UTC (rev 34)
@@ -32,14 +32,14 @@
 
 setup(
     name="FelloWiki",
-    version="0.01-dev20061118",
+    version="0.01a1",
     
     description='Yet another wiki engine',
     long_description='Yet another wiki engine - still heavily in alpha',
     author="Jan Niklas Fingerle",
-    #author_email='xxx at yyy.invalid',
-    #url='http://www.fellowiki.org',
-    #download_url='http://download.fellowiki.org',
+    author_email='fingerle at users.berlios.de',
+    url='http://developer.berlios.de/projects/fellowiki/',
+    download_url='http://developer.berlios.de/project/showfiles.php?group_id=6220',
     license='MIT-style',
     
     install_requires = [



From fingerle at mail.berlios.de  Wed Nov 22 01:58:17 2006
From: fingerle at mail.berlios.de (fingerle at BerliOS)
Date: Wed, 22 Nov 2006 01:58:17 +0100
Subject: [fellowiki-svncheckins] r35 - pjm
Message-ID: <200611220058.kAM0wHbA013836@sheep.berlios.de>

Author: fingerle
Date: 2006-11-22 01:58:17 +0100 (Wed, 22 Nov 2006)
New Revision: 35

Added:
   pjm/rollout-trunk-current.sh
Log:
Some changes for setuptools, helper script


Added: pjm/rollout-trunk-current.sh
===================================================================
--- pjm/rollout-trunk-current.sh	2006-11-22 00:38:16 UTC (rev 34)
+++ pjm/rollout-trunk-current.sh	2006-11-22 00:58:17 UTC (rev 35)
@@ -0,0 +1,10 @@
+#!/bin/sh
+
+# This is an *example script* which works on my local configuration.
+#
+# Usage: generate sdist and egg from current trunk
+
+cd ~/src/fellowiki/trunk
+svn up && \
+svn st && \
+python2.4 setup.py egg_info -rb.dev sdist --formats=gztar,zip bdist_egg > /dev/null


Property changes on: pjm/rollout-trunk-current.sh
___________________________________________________________________
Name: svn:executable
   + *



From fingerle at mail.berlios.de  Wed Nov 22 02:30:04 2006
From: fingerle at mail.berlios.de (fingerle at BerliOS)
Date: Wed, 22 Nov 2006 02:30:04 +0100
Subject: [fellowiki-svncheckins] r36 - pjm trunk
Message-ID: <200611220130.kAM1U3fU018524@sheep.berlios.de>

Author: fingerle
Date: 2006-11-22 02:30:01 +0100 (Wed, 22 Nov 2006)
New Revision: 36

Added:
   trunk/setup.cfg
Modified:
   pjm/rollout-trunk-current.sh
Log:
changes for setuptools


Modified: pjm/rollout-trunk-current.sh
===================================================================
--- pjm/rollout-trunk-current.sh	2006-11-22 00:58:17 UTC (rev 35)
+++ pjm/rollout-trunk-current.sh	2006-11-22 01:30:01 UTC (rev 36)
@@ -4,7 +4,16 @@
 #
 # Usage: generate sdist and egg from current trunk
 
-cd ~/src/fellowiki/trunk
-svn up && \
-svn st && \
-python2.4 setup.py egg_info -rb.dev sdist --formats=gztar,zip bdist_egg > /dev/null
+RODIR=~/.fellowiki-rollout-tmp && \
+DISTDIR=~/src/fellowiki-dist && \
+CWD=`pwd` && \
+rm -rf $RODIR && \
+echo svn... && \
+svn co svn://svn.berlios.de/fellowiki/trunk $RODIR > /dev/null && \
+cd $RODIR && \
+echo setup.py... && \
+python2.4 setup.py egg_info sdist --formats=gztar,zip bdist_egg > /dev/null && \
+cd dist && \
+echo generated: `ls *` && \
+cp * $DISTDIR
+cd $CWD

Added: trunk/setup.cfg
===================================================================
--- trunk/setup.cfg	2006-11-22 00:58:17 UTC (rev 35)
+++ trunk/setup.cfg	2006-11-22 01:30:01 UTC (rev 36)
@@ -0,0 +1,3 @@
+[egg_info]
+tag_build = .dev
+tag_svn_revision = 1



From fingerle at mail.berlios.de  Wed Nov 22 03:55:51 2006
From: fingerle at mail.berlios.de (fingerle at BerliOS)
Date: Wed, 22 Nov 2006 03:55:51 +0100
Subject: [fellowiki-svncheckins] r37 - pjm trunk
Message-ID: <200611220255.kAM2tplC026137@sheep.berlios.de>

Author: fingerle
Date: 2006-11-22 03:55:51 +0100 (Wed, 22 Nov 2006)
New Revision: 37

Added:
   pjm/rollout-trunk-current-upload.sh
Modified:
   pjm/rollout-trunk-current.sh
   trunk/setup.py
Log:
Some more changes for setuptools.


Added: pjm/rollout-trunk-current-upload.sh
===================================================================
--- pjm/rollout-trunk-current-upload.sh	2006-11-22 01:30:01 UTC (rev 36)
+++ pjm/rollout-trunk-current-upload.sh	2006-11-22 02:55:51 UTC (rev 37)
@@ -0,0 +1,13 @@
+#!/bin/sh
+
+# This is an *example script* which works on my local configuration.
+#
+# Usage: after confirming everything is fine: register and upload
+
+RODIR=~/.fellowiki-rollout-tmp && \
+DISTDIR=~/src/fellowiki-dist && \
+CWD=`pwd` && \
+cd $RODIR && \
+echo setup.py... && \
+python2.4 setup.py register sdist --formats=gztar,zip bdist_egg upload && \
+cd $CWD


Property changes on: pjm/rollout-trunk-current-upload.sh
___________________________________________________________________
Name: svn:executable
   + *

Modified: pjm/rollout-trunk-current.sh
===================================================================
--- pjm/rollout-trunk-current.sh	2006-11-22 01:30:01 UTC (rev 36)
+++ pjm/rollout-trunk-current.sh	2006-11-22 02:55:51 UTC (rev 37)
@@ -12,7 +12,7 @@
 svn co svn://svn.berlios.de/fellowiki/trunk $RODIR > /dev/null && \
 cd $RODIR && \
 echo setup.py... && \
-python2.4 setup.py egg_info sdist --formats=gztar,zip bdist_egg > /dev/null && \
+python2.4 setup.py sdist --formats=gztar,zip bdist_egg > /dev/null && \
 cd dist && \
 echo generated: `ls *` && \
 cp * $DISTDIR

Modified: trunk/setup.py
===================================================================
--- trunk/setup.py	2006-11-22 01:30:01 UTC (rev 36)
+++ trunk/setup.py	2006-11-22 02:55:51 UTC (rev 37)
@@ -32,7 +32,7 @@
 
 setup(
     name="FelloWiki",
-    version="0.01a1",
+    version="0.1a1",
     
     description='Yet another wiki engine',
     long_description='Yet another wiki engine - still heavily in alpha',



